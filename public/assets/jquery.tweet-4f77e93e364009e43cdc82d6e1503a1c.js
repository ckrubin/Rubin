!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){e.fn.tweet=function(t){function a(e,t){if("string"==typeof e){var a=e;for(var r in t){var n=t[r];a=a.split("{"+r+"}").join(null===n?"":n)}return a}return e(t)}function r(t,a){return function(){var r=[];return this.each(function(){r.push(this.replace(t,a))}),e(r)}}function n(e){return e.replace(/</g,"&lt;").replace(/>/g,"^&gt;")}function i(e,t){return e.replace(m,function(e){for(var a=/^[a-z]+:/i.test(e)?e:"http://"+e,r=e,i=0;i<t.length;++i){var s=t[i];if(s.url===a&&s.expanded_url){a=s.expanded_url,r=s.display_url;break}}return'<a href="'+n(a)+'">'+n(r)+"</a>"})}function s(e){return Date.parse(e.replace(/^([a-z]{3})( [a-z]{3} \d\d?)(.*)( \d{4})$/i,"$1,$2$4$3"))}function _(e){var t=function(e){return parseInt(e,10)},a=new Date,r=t((a.getTime()-e)/1e3);return 1>r&&(r=0),{days:t(r/86400),hours:t(r/3600),minutes:t(r/60),seconds:t(r)}}function o(e){return e.days>2?p.days_ago_text.replace("%d",e.days):e.hours>24?p.a_day_ago_text:e.hours>2?p.hours_ago_text.replace("%d",e.hours):e.minutes>45?p.a_hours_ago_text:e.minutes>2?p.minutes_ago_text.replace("%d",e.minutes):e.minutes>1?p.a_minutes_ago_text:e.seconds>1?p.seconds_ago_text.replace("%d",e.seconds):p.just_now_text}function u(e){return e.match(/^(@([A-Za-z0-9-_]+)) .*/i)?p.auto_join_text_reply:e.match(m)?p.auto_join_text_url:e.match(/^((\w+ed)|just) .*/im)?p.auto_join_text_ed:e.match(/^(\w*ing) .*/i)?p.auto_join_text_ing:p.auto_join_text_default}function l(){var e=p.twitter_api_url;e+=e.indexOf("?")>=0?"&url=":"?url=";var t=("https:"==document.location.protocol?"https:":"http:",null===p.fetch?p.count:p.fetch),a="&include_entities=1";if(p.list)return e+encodeURIComponent(p.username[0]+"/lists/"+p.list+"/statuses.json?page="+p.page+"&per_page="+t+a);if(p.favorites)return e+encodeURIComponent("favorites.json?screen_name="+p.username[0]+"&page="+p.page+"&count="+t+a);if(null===p.query&&1===p.username.length)return e+encodeURIComponent("statuses/user_timeline.json?screen_name="+p.username[0]+"&count="+t+(p.retweets?"&include_rts=1":"")+"&page="+p.page+a);var r=p.query||"from:"+p.username.join(" OR from:");return e+encodeURIComponent("search/tweets.json?q="+r+a)}function c(e,t){return t?"user"in e?e.user.profile_image_url_https:c(e,!1).replace(/^http:\/\/[a-z0-9]{1,3}\.twimg\.com\//,"https://s3.amazonaws.com/twitter_production/"):e.profile_image_url||e.user.profile_image_url}function d(t){var r={};return r.item=t,r.source=t.source,r.screen_name=t.from_user||t.user.screen_name,r.name=t.from_user_name||t.user.name,r.retweet="undefined"!=typeof t.retweeted_status,r.tweet_time=s(t.created_at),r.join_text="auto"===p.join_text?u(t.text):p.join_text,r.tweet_id=t.id_str,r.twitter_base="http://"+p.twitter_url+"/",r.user_url=r.twitter_base+r.screen_name,r.tweet_url=r.user_url+"/status/"+r.tweet_id,r.reply_url=r.twitter_base+"intent/tweet?in_reply_to="+r.tweet_id,r.retweet_url=r.twitter_base+"intent/retweet?tweet_id="+r.tweet_id,r.favorite_url=r.twitter_base+"intent/favorite?tweet_id="+r.tweet_id,r.retweeted_screen_name=r.retweet&&t.retweeted_status.user.screen_name,r.tweet_relative_time=o(_(r.tweet_time)),r.entities=t.entities?(t.entities.urls||[]).concat(t.entities.media||[]):[],r.tweet_raw_text=r.retweet?"RT @"+r.retweeted_screen_name+" "+t.retweeted_status.text:t.text,r.tweet_text=e([i(r.tweet_raw_text,r.entities)]).linkUser().linkHash()[0],r.retweeted_tweet_text=e([i(t.text,r.entities)]).linkUser().linkHash()[0],r.tweet_text_fancy=e([r.tweet_text]).makeHeart()[0],r.avatar_size=p.avatar_size,r.avatar_url=c(r.retweet?t.retweeted_status:t,"https:"===document.location.protocol),r.avatar_screen_name=r.retweet?r.retweeted_screen_name:r.screen_name,r.avatar_profile_url=r.twitter_base+r.avatar_screen_name,r.user=a('<a class="tweet_user" href="{user_url}">{screen_name}</a>',r),r.join=p.join_text?a('<span class="tweet_join">{join_text}</span>',r):"",r.avatar=r.avatar_size?a('<a class="tweet_avatar" href="{avatar_profile_url}"><img src="{avatar_url}" height="{avatar_size}" width="{avatar_size}" alt="{avatar_screen_name}\'s avatar" title="{avatar_screen_name}\'s avatar" border="0"/></a>',r):"",r.time=a('<span class="tweet_time"><a href="{tweet_url}" title="view tweet on twitter">{tweet_relative_time}</a></span>',r),r.text=a('<span class="tweet_text">{tweet_text_fancy}</span>',r),r.retweeted_text=a('<span class="tweet_text">{retweeted_tweet_text}</span>',r),r.reply_action=a('<a class="tweet_action tweet_reply" href="{reply_url}">reply</a>',r),r.retweet_action=a('<a class="tweet_action tweet_retweet" href="{retweet_url}">retweet</a>',r),r.favorite_action=a('<a class="tweet_action tweet_favorite" href="{favorite_url}">favorite</a>',r),r}function w(t,r){var n=e('<ul class="tweet_list">');n.append(e.map(r,function(e){return"<li>"+a(p.template,e)+"</li>"}).join("")).children("li:first").addClass("tweet_first").end().children("li:odd").addClass("tweet_even").end().children("li:even").addClass("tweet_odd"),e(t).empty().append(n),p.intro_text&&n.before('<p class="tweet_intro">'+p.intro_text+"</p>"),p.outro_text&&n.after('<p class="tweet_outro">'+p.outro_text+"</p>"),e(t).trigger("loaded").trigger(0===r.length?"empty":"full"),p.refresh_interval&&window.setTimeout(function(){e(t).trigger("tweet:load")},1e3*p.refresh_interval)}function f(t){var a=e('<p class="loading">'+p.loading_text+"</p>");p.loading_text&&e(t).not(":has(.tweet_list)").empty().append(a),e.getJSON(l(),function(a){var r=e.map(a.statuses||a,d);r=e.grep(r,p.filter).sort(p.comparator).slice(0,p.count),e(t).trigger("tweet:retrieved",[r])})}var p=e.extend({username:null,list:null,favorites:!1,query:null,avatar_size:null,count:3,fetch:null,page:1,retweets:!0,intro_text:null,outro_text:null,join_text:null,auto_join_text_default:" I said, ",auto_join_text_ed:" I ",auto_join_text_ing:" I am ",auto_join_text_reply:" I replied to ",auto_join_text_url:" I was looking at ",loading_text:null,refresh_interval:null,twitter_url:"twitter.com",twitter_api_url:"api.twitter.com",twitter_search_url:"search.twitter.com",template:"{avatar}{time}{join} {text}",just_now_text:"just now",seconds_ago_text:"about %d seconds ago",a_minutes_ago_text:"about a minute ago",minutes_ago_text:"about %d minutes ago",a_hours_ago_text:"about an hour ago",hours_ago_text:"about %d hours ago",a_day_ago_text:"about a day ago",days_ago_text:"about %d days ago",comparator:function(e,t){return t.tweet_time-e.tweet_time},filter:function(){return!0}},t),m=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gi;return e.extend({tweet:{t:a}}),e.fn.extend({linkUser:r(/(^|[\W])@(\w+)/gi,'$1<span class="at">@</span><a href="http://'+p.twitter_url+'/$2">$2</a>'),linkHash:r(/(?:^| )[\#]+([\w\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u00ff\u0600-\u06ff]+)/gi,' <a href="https://'+p.twitter_url+"/search?q=%23$1&src=hash&lang=all"+(p.username&&1===p.username.length&&!p.list?"&from="+p.username.join("%2BOR%2B"):"")+'" class="tweet_hashtag">#$1</a>'),makeHeart:r(/(&lt;)+[3]/gi,"<tt class='heart'>&#x2665;</tt>")}),this.each(function(t,a){p.username&&"string"==typeof p.username&&(p.username=[p.username]),e(a).unbind("tweet:render").unbind("tweet:retrieved").unbind("tweet:load").bind({"tweet:load":function(){f(a)},"tweet:retrieved":function(t,r){e(a).trigger("tweet:render",[r])},"tweet:render":function(t,r){w(e(a),r)}}).trigger("tweet:load")})}});